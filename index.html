<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/index.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="imageModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <img id="modalImage" src="" alt="Image Preview" />
      </div>
    </div>

    <div class="header">
      <a href="#default" class="logo">Shapi</a>
      <div class="header-right">
        <a class="active" href="#home">Add Product</a>
        <a href="#contact">Shop Now</a>
        <a href="#about">About</a>
      </div>
    </div>

    <div style="padding-left: 20px">
      <h1 class="customerInformation">Add Product</h1>

      <div class="tableDivision">
        <form onsubmit="submitSuccess()">
          <div class="form-group">
            <label for="productName">Product Name</label>
            <input
              class="form-control"
              id="productName"
              placeholder="Enter product"
              required
            />
          </div>

          <div class="mb-3">
            <label for="productDesc" class="form-label">Description</label>
            <textarea
              class="form-control"
              id="productDesc"
              rows="3"
              required
            ></textarea>
          </div>

          <div class="form-group">
            <label for="productName">Image for the product</label>
            <input
              class="form-control"
              type="file"
              id="imageLocation"
              style="padding-bottom: 2%"
              accept="image/*"
            />
          </div>

          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>

      <div class="tableDivision">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Product Name</th>
              <th scope="col">Description</th>
              <th scope="col">Image</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Dynamic Rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>
  </body>

  <script>
    let submittedData = JSON.parse(localStorage.getItem("submittedData")) || [];

    function submitSuccess() {
      let productName = document.getElementById("productName").value;
      let productDesc = document.getElementById("productDesc").value;
      let imageInput = document.getElementById("imageLocation");

      // Handle file input and create a FileReader to get the image URL
      if (imageInput.files && imageInput.files[0]) {
        let reader = new FileReader();

        // Once the file is read, store the image data in localStorage and display it
        reader.onload = function (e) {
          let imageLocation = e.target.result; // This will be a base64 image URL

          // Store the values in an object
          let dataEntry = {
            productName: productName,
            productDesc: productDesc,
            imageLocation: imageLocation, // Base64 image data
          };

          // Add the new entry to the array
          submittedData.push(dataEntry);

          // Save the updated array to localStorage
          localStorage.setItem("submittedData", JSON.stringify(submittedData));

          // Update the display
          displayData();
        };

        // Read the image file as a data URL (base64)
        reader.readAsDataURL(imageInput.files[0]);
      }
    }

    function displayData() {
      let tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = ""; // Clear the table body before adding new rows

      // Loop through submittedData and create table rows
      submittedData.forEach((entry, index) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <th scope="row">${index + 1}</th>
          <td>${entry.productName}</td>
          <td>${entry.productDesc}</td>
          <td><img src="${
            entry.imageLocation
          }" alt="Uploaded Image" width="100" /></td>
          <td>
            <button id="buttonTableSize" onclick="deleteEntry(${index})" type="button" class="btn btn-danger">Delete</button>
            <button id="buttonTableSize" onclick="viewImage('${
              entry.imageLocation
            }')" type="button" class="btn btn-primary">View</button>
            </td></td>
         
        `;
        tableBody.appendChild(row);
      });

      document.getElementById("productDesc").value = "";
      document.getElementById("productName").value = "";
      document.getElementById("imageLocation").value = "";
    }

    function deleteEntry(index) {
      submittedData.splice(index, 1);
      localStorage.setItem("submittedData", JSON.stringify(submittedData));
      displayData();
    }

    function viewImage(imageUrl) {
      var modal = document.getElementById("imageModal");
      var modalImg = document.getElementById("modalImage");
      modal.style.display = "block";
      modalImg.src = imageUrl;
    }

    function closeModal() {
      var modal = document.getElementById("imageModal");
      modal.style.display = "none";
    }

    window.onload = function () {
      displayData();
    };
  </script>
</html>
